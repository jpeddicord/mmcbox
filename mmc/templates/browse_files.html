{% extends 'layout.html' %}

{% block head %}
{{ super() }}
<script src="{{ url_for('static', filename='jquery.iframe-transport.js') }}"></script>
<script src="{{ url_for('static', filename='jquery.fileupload.js') }}"></script>
<link rel="stylesheet" media="screen" href="{{ url_for('static', filename='browser.css') }}" />

<script type="text/javascript">
	$(function() {
		// tooltips
		$('button').twipsy({placement: 'right'});

		// button actions
		$('#newfile').click(function(){
			name = prompt("Filename?");
			if (name) {
				$.post('{{ url_for('new_file', domain=domain) }}',
					{'path': '{{ path }}', 'filename': name},
					function() {
						window.location.reload();
					}
				);
			}
		});
		$('#newfolder').click(function(){
		});
		$('#upload').click(function(){
		});

		// upload magic
		$('#fileupload').fileupload({
			dataType: 'json',
			url: '{{ url_for('upload_file', domain=domain) }}',
			formData: {'path': '{{ path }}'},
			done: function(e, data) {
				window.location.reload();
			},
			error: function(jqXHR, textStatus, errorThrown) {
				alert("Upload failed. It may be too large, or not an acceptable type.");
			}
		});
	});
</script>
{% endblock %}

{% block content %}
<div class="alert-message warning"><p>
	<strong>Heads up:</strong> I'm still working on a lot of stuff here. Some things just don't work at the moment. I'm working on this weekly, but for now, the following things are missing: renaming and deleting files, creating folders, moving files, downloading your site.
</p></div>


<div class="well">
	<button id="newfile" class="btn info primary">New File</button>
	<button id="newfolder" class="btn" title="This doesn't work right now. Sorry.">New Folder</button>
	<!--<button id="upload" class="btn" title="You can also upload files by dragging them onto the page!">Upload
	</button>-->
	<span style="margin-left: 10px;">Upload: <input id="fileupload" type="file" name="files[]" multiple></span>
</div>


<ul id="browser">
	{% if path %}
	<li class="folder">
	<a href="../" class="ui-button-content">^ Up..</a>
	</li>
	{% endif %}

	{% for d in dirs %}
	<li class="folder">
		<ul>
			<li class="delete">delete</li>
			<li class="rename">rename</li>
		</ul>
		<a href="{{ d }}/" class="ui-button-content">{{ d }}/</a>
	</li>
	{% endfor %}

	{% for f in files %}
	<li class="file">
		<ul>
			<li class="delete">delete</li>
			<li class="rename">rename</li>
		</ul>
		<a href="{{ url_for('edit_file', domain=domain, path=join(path, f)) }}">{{ f }}</a>
	</li>
	{% endfor %}
</ul>

{% endblock %}
